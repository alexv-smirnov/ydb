# Manage YDB releases

На базе исходного коде из репозитория YDB разрабатываются два продукта с независимыми релизными циклами:

- [Сервер YDB](#server)
- [Интерфейс командной строки YDB (CLI)](#cli)

## Релизный цикл сервера YDB {#server}

### Номера и расписание релизов {#server-versioning}

Мажорная версия сервера YDB состоит из двух чисел, разделенных точкой. Первое число - это две цифры, указывающие год, а второе - порядковый номер релиза в течение этого года. Например, `23.3` - это 3-й мажорный релиз 2023 года.

В рамках жизненного цикла разработки сервера YDB может быть выпущено несколько минорных версий, порядковый номер которых добавляется после точки к мажорной версии. Таким образом, полный номер версии для сервера YDB выглядит как `23.3.5`, где `23.3` - мажорная версия, а `5` - минорная.

Расписание релизов сервера YDB включает в себя 4 мажорных релиза ежегодно, поэтому релиз `YY.1` является первым, а `YY.4` - последним в году `YY`. Количество минорных релизов не является постоянным и может варьироваться от одного мажорного к другому.

### Совместимость {#server-compatibility}

YDB поддерживает совместимость между мажорными версиями таким образом, чтобы гарантировать, что кластер может работать, когда на его узлах выполняются две смежные мажорные версии исполняемого файла сервера YDB. Вы можете обратиться к статье [Обновление YDB](../administration/upgrade.md) для информации о процедуре обновления кластера.

Учитывая вышеуказанную цель совместимости, мажорные релизы выпускаются парами, с добавлением в нечетных версия новой функциональности, отключенной feature-флагами, и включением этой функциональности в четных.

Например, версия `23.1` поставляется с отключенной новой функциональностью и может быть постепенно развернута на кластере, работающем под управлением `22.4`, без остановки работы кластера. Как только на всех узлах кластера будет запущена `23.1`, его можно будет далее обновить до `23.2`, чтобы использовать новые функциональные возможности.

### Релизные ветки и теги {#server-branches-tags}

Цикл выпуска для нечетного мажорного релиза начинается с отведения ветки от trunk (`main`) участником [релизной команды YDB](https://github.com/orgs/ydb-platform/teams/release). С этого момента мы замораживаем набор функций, работая над его стабилизацией.

Название релизной ветки начинается с символов `stable-`, за которыми следует мажорная версия с точками, замененными на тире (например, `stable-23-4`).

Цикл выпуска четного мажорного релиза начинается с отведения ветки от ветки предыдущего нечетного мажорного релиза.

Все выпуски мажорных версий, как четных, так и нечетных, проходят цикл тестирования, в процессе которого создается ряд минорных версий. Каждая минорная версия фиксируется путем назначения тега с полным номером версии на соответствующей релизной ветке. Таким образом, в ветке `stable-24-1` могут быть теги `24.1.1`, `24.1.2` и т.д. Как только минорная версия успешно прошла необходимое тестирование, мы считаем ее стабильной, и регистрируем релиз на GitHub для ее тега.

Для мажорной версии может быть более одной стабильного релиза.

### Тестирование {#server-testing}

Тестирование релиза является итеративным. Каждая итерация начинается с назначения тега на коммит в релизной ветке для минорной версии, подлежащей тестированию. Например, тег минорной версии `23.3.5` отмечает 5-ю итерацию тестирования для мажорной версии `23.3`.

Тег может считаться либо "кандидатом", либо "стабильным". Изначально первый тег назначается релизной ветке сразу после ее создания, и этот тег считается "кандидатом".

Во время итерации тестирования код из релизных веток проходит всестороннее тестирование, включая развертывание в UAT/prestable и production средах основных пользователей. Для выполнения такого тестирования код YDB из релизного тега на GitHub импортируется в корпоративный контекст основного пользователя в соответствии с его политиками и стандартами. Затем производится его сборка, развертывание в необходимых средах, и тестирование.

{% include [corp_release_testing.md](_includes/corp_release_testing.md) %}

Основываясь на перечне выявленных проблем, [релизная команда YDB](https://github.com/orgs/ydb-platform/teams/release) решает, можно ли повысить статус минорного релиза до стабильного, или необходимо запустить новую итерацию тестирования с новым тегом минорного релиза. Фактически, как только во время тестирования обнаруживается критическая проблема, разработчики исправляют ее в trunk и сразу же мержат изменения в релизную ветку. Таким образом, к моменту завершения тестирования, если в релизной ветке есть какие-либо коммиты поверх текущего тега, это означает что последует новый тег и новая итерация тестирования.

### Стабильный релиз {#server-stable}

Если итерация тестирования подтверждает качество минорного релиза, [релизная команда YDB](https://github.com/orgs/ydb-platform/teams/release) готовит перечень изменений, и публикует релиз на странице [Releases](https://github.com/ydb-platform/ydb/releases) на GitHub, объявляя его тем самым стабильным.

{% include [corp_release_stable.md](_includes/corp_release_stable.md) %}

## Цикл выпуска YDB CLI (интерфейс командной строки) {#cli}

### Номера выпусков и расписание {#cli-versioning}

Версия YDB CLI состоит из трех чисел, разделенных точкой. Первое число - мажорная версия (в настоящее время "2"), второе - минорная, а третье - номер патча. Например, `2.8.0` - это 2-я мажорная, 8-я минорная, без патчей.

Для минорных релизов YDB CLI не существует расписания, новый релиз выходит в тот момент, когда у нас появляется некоторая новая ценная функциональность. Изначально каждый новый минорный релиз имеет "0" в качестве номера патча. Если в этой версии обнаруживаются критические ошибки, или в неё не вошла какая-то незначительная часть запланированной функциональности, мы можем выпустить патч, увеличив только номер патча, как это было для `2.1.1`.

В целом, цикл выпуска для YDB CLI намного проще и короче, чем для сервера, что приводит к более частым выпускам.

### Релизные теги {#cli-tags}

Теги для YDB CLI назначаются в транке (ветка `main`) участником [релизной команды YDB](https://github.com/orgs/ydb-platform/teams/release) после запуска тестов для некоторой ревизии. Чтобы отличаться от тегов сервера YDB, теги CLI YDB содержат символы `CLI_`, предшествующие номеру версии, например [CLI_2.8.0](https://github.com/ydb-platform/ydb/tree/CLI_2.8.0).

{% include [corp_cli_tags.md](_includes/corp_cli_tags.md) %}

### Стабильный релиз {#cli-stable}

Чтобы объявить тег YDB CLI стабильным, участник [релизной команды YDB](https://github.com/orgs/ydb-platform/teams/release) готовит перечень изменений, и публикует релиз на странице GitHub [Releases](https://github.com/ydb-platform/ydb/releases).
